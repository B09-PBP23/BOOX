{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}


{% block meta %}
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <title>Cyborg - Awesome HTML5 Template</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-cyborg-gaming.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet"href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
    <style>
      div.stars {
      width: 270px;
      display: inline-block;
      }
      
      input.star { display: none; }
      
      label.star {
      float: right;
      padding: 10px;
      font-size: 36px;
      color: #444;
      transition: all .2s;
      }
      
      input.star:checked ~ label.star:before {
      content: '\f005';
      color: #FD4;
      transition: all .25s;
      }
      
      input.star-5:checked ~ label.star:before {
      color: #FE7;
      text-shadow: 0 0 20px #952;
      }
      
      input.star-1:checked ~ label.star:before { color: #F62; }
      
      label.star:hover { transform: rotate(-15deg) scale(1.3); }
      
      label.star:before {
      content: '\f006';
      font-family: FontAwesome;
      }
    </style>
{% endblock meta %}

{% block content %}
 
  <!-- ***** Header Area End ***** -->
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div style="width:82%;margin-bottom: 30px; margin-left: auto; margin-right: auto;" class="page-content">
          
          <!-- ***** Featured Start ***** -->
          <div   class="row">
            <div class="col-lg-12">
              <div class="feature-banner header-text">
                <div  class="row">
                  <h2 style="text-align: center;">Edit Review</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>

          <!-- ***** Featured End ***** -->
          
          <div  style="margin:auto;display:flex;justify-content:space-between;width:75%; background-color: #27292a; padding: 60px 0px;border-radius: 23px;" >

            
            
            <div class="container mt-5">
              <div class="row justify-content-center">
                <div class="col-md-8">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">{{ book.title }}</h4>
                      <h6>{{ book.year }}</h6>
                      <img src="{{ book.image_url_s }}" class="img-fluid mb-3" alt="{{ book.title }}">
                      <p class="text-muted">{{ book.author }}</p>
                      <p>{{ book.publisher }}</p>

                      <!-- Begin AJAX form -->
                      <form id="reviewForm">
                        {% csrf_token %}
                        <div class="mb-3">
                          <label for="{{ form.review.id_for_label }}" class="form-label">Review:</label>
                          {{ form.review|add_class:"form-control" }}
                        </div>
                        <div class="mb-3">
                          <label for="{{ form.rating.id_for_label }}" class="form-label">Rating (1-10):</label>
                          {{ form.rating|add_class:"form-control" }}
                        </div>
                        <button type="submit" class="btn btn-primary">Save Review</button>
                      </form>
                      <!-- End AJAX form -->

                    </div>
                  </div>
                </div>
              </div>
            </div>

          
          
          </div>

          
          
         
          <!-- ***** Details Start ***** -->
          
  



  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
  {% load static %}

  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
  

  <script src="{% static 'assets/js/isotope.min.js' %}"></script>
  <script src="{% static 'assets/js/owl-carousel.js' %}"></script>
  <script src="{% static 'assets/js/tabs.js' %}"></script>
  <script src="{% static 'assets/js/popup.js' %}"></script>
  <script src="{% static 'assets/js/custom.js' %}"></script>



  {% endblock content %}
  {% block extra_js %}
  <script>

  
  $('#reviewForm').submit(function(e) {
    e.preventDefault();
    var serializedData = $(this).serializeArray();
    var data = {'id': ((window.location.pathname).split("/"))[2]};

    // Convert form data to JSON object
    $.each(serializedData, function(index, field) {
      data[field.name] = field.value;
    });
    // console.log('Data being sent:', data); // Check the data being sent
    // console.log(headers); // Check the headers being sent

    $.ajax({
      type: 'POST',
      url: '{% url "editreview:edit_review_ajax" %}',
      data: JSON.stringify(data),
      contentType: 'application/json; charset=utf-8',
      dataType: 'json',
      headers: { 'X-CSRFToken': data["csrfmiddlewaretoken"]},
      success: function(response) {
        // If the review was updated successfully, display the success message
        if(response.status === 'success') {
          alert("Review berhasil diedit"); // You might want to replace this with a more elegant message display
          // Optionally, clear the form or perform other actions
        } else {
          // If the server responded with a success status, but the action was not successful
          alert("Review gagal diedit 1: " + response.message);
        }
      },
      error: function(response) {
        // Handle error - display error message from server if available, or a generic error message
        var errorMessage = "Review gagal diedit";
        if(response.responseJSON && response.responseJSON.message) {
          errorMessage += ": " + response.responseJSON.message;
        }
        alert(errorMessage);
      }
    });
  });
  </script>
  {% endblock extra_js %}